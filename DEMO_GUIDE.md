# Real-time Query Flow ë°ëª¨ ê°€ì´ë“œ

Real-time Query Flow íŒ¨ë„ì˜ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë°ëª¨ìš© ìƒ˜í”Œ ë°ì´í„° ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. í•„ìš”í•œ ë„êµ¬ ì„¤ì¹˜

```bash
# macOS (Homebrew)
brew install bc websocat

# Ubuntu/Debian
sudo apt-get update
sudo apt-get install bc
npm install -g wscat

# ë˜ëŠ” curl ì‚¬ìš© (ëŒ€ë¶€ë¶„ ì‹œìŠ¤í…œì— ê¸°ë³¸ ì„¤ì¹˜ë¨)
```

### 2. ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰

```bash
# control-plane ì„œë²„ ì‹¤í–‰ (í¬íŠ¸ 8080)
cd control-plane
go run main.go
```

### 3. í”„ë¡ íŠ¸ì—”ë“œ ëŒ€ì‹œë³´ë“œ ì‹¤í–‰

```bash
# dashboard-frontend ì‹¤í–‰ (í¬íŠ¸ 3000)
cd dashboard-frontend  
npm run dev
```

### 4. ë°ëª¨ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
# ë°ëª¨ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (60ì´ˆê°„)
./demo-query-flow.sh
```

ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:3000`ìœ¼ë¡œ ì ‘ì†í•˜ì—¬ Real-time Query Flow íŒ¨ë„ì˜ ì• ë‹ˆë©”ì´ì…˜ì„ í™•ì¸í•˜ì„¸ìš”.

## ğŸ“Š ë°ëª¨ ì‹œë‚˜ë¦¬ì˜¤

ìŠ¤í¬ë¦½íŠ¸ëŠ” 15ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ë“¤ì„ ìˆœí™˜í•©ë‹ˆë‹¤:

### NORMAL (ì •ìƒ ìƒíƒœ)
- **QPS**: 2 queries/sec
- **ì§€ì—°ì‹œê°„**: ì •ìƒ
- **ì—ëŸ¬ìœ¨**: ìµœì†Œ

### HIGH_LOAD (ë†’ì€ ë¶€í•˜)
- **QPS**: 6 queries/sec (3ë°° ì¦ê°€)
- **ì§€ì—°ì‹œê°„**: 1.5ë°° ì¦ê°€
- **ì—ëŸ¬ìœ¨**: 1.2ë°° ì¦ê°€

### SLOW_QUERIES (ëŠë¦° ì¿¼ë¦¬)
- **QPS**: 1.6 queries/sec (80% ìˆ˜ì¤€)
- **ì§€ì—°ì‹œê°„**: 3ë°° ì¦ê°€
- **ì—ëŸ¬ìœ¨**: 2ë°° ì¦ê°€

### ERROR_SPIKE (ì—ëŸ¬ ê¸‰ì¦)
- **QPS**: 2.4 queries/sec (1.2ë°° ì¦ê°€)
- **ì§€ì—°ì‹œê°„**: ì •ìƒ
- **ì—ëŸ¬ìœ¨**: 5ë°° ì¦ê°€

## ğŸ¯ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼

### 1. Flow Diagram
- App â†’ Pool â†’ DB â†’ App ë…¸ë“œ ê°„ ì—°ê²°ì„  ì• ë‹ˆë©”ì´ì…˜
- í™œì„± ì»¤ë„¥ì…˜ ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

### 2. Query Particles
- ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ì— ë”°ë¥¸ íŒŒí‹°í´ ìƒ‰ìƒ ë³€í™”:
  - ğŸŸ¢ **ì´ˆë¡**: 10ms ì´í•˜ (ë¹ ë¥¸ ì¿¼ë¦¬)
  - ğŸŸ  **ì£¼í™©**: 10-50ms (ë³´í†µ ì¿¼ë¦¬)
  - ğŸŸ¡ **ë…¸ë‘**: 50ms ì´ìƒ (ëŠë¦° ì¿¼ë¦¬)
  - ğŸ”´ **ë¹¨ê°•**: ì—ëŸ¬ ë°œìƒ

### 3. Real-time Query List
- ìƒˆë¡œìš´ ì¿¼ë¦¬ ìŠ¬ë¼ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜
- ì‹¤í–‰ ì‹œê°„ë³„ ìƒ‰ìƒ êµ¬ë¶„
- ì—ëŸ¬ ì¿¼ë¦¬ ê°•ì¡° í‘œì‹œ

### 4. Connection Status
- WebSocket ì—°ê²° ìƒíƒœ ì‹¤ì‹œê°„ í‘œì‹œ
- ì—°ê²° ì¤‘ì¼ ë•Œ íšŒì „ ì• ë‹ˆë©”ì´ì…˜

## ğŸ”§ ìŠ¤í¬ë¦½íŠ¸ êµ¬ì„±

### ì¿¼ë¦¬ íŒ¨í„´
```sql
SELECT * FROM users WHERE id = ?                     # ë¹ ë¥¸ ë‹¨ìˆœ ì¡°íšŒ
SELECT u.*, p.* FROM users u JOIN profiles p...      # ì¡°ì¸ ì¿¼ë¦¬
UPDATE users SET last_login = NOW() WHERE id = ?     # ì—…ë°ì´íŠ¸
INSERT INTO orders (user_id, product_id...)          # ì‚½ì…
SELECT COUNT(*) FROM orders WHERE created_at >= ?    # ì§‘ê³„ ì¿¼ë¦¬ (ì¤‘ê°„ ì†ë„)
SELECT o.*, u.username, p.name FROM orders o...      # ë³µì¡í•œ ì¡°ì¸ (ëŠë¦¼)
DELETE FROM sessions WHERE expires_at < NOW()        # ì‚­ì œ
```

### ë©”íŠ¸ë¦­ ë°ì´í„°
- **ì»¤ë„¥ì…˜ í’€**: í™œì„±/ìœ íœ´/ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ˜
- **ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­**: í™ ë©”ëª¨ë¦¬, CPU ì‚¬ìš©ë¥ 
- **ì¿¼ë¦¬ ë©”íŠ¸ë¦­**: ì‹¤í–‰ ì‹œê°„, ìƒíƒœ, ì—ëŸ¬ ë©”ì‹œì§€

## ğŸ® ì‚¬ìš©ë²•

```bash
# ê¸°ë³¸ ì‹¤í–‰ (60ì´ˆ)
./demo-query-flow.sh

# ì¤‘ë‹¨í•˜ë ¤ë©´
Ctrl+C
```

## ğŸ” ë¡œê·¸ í™•ì¸

ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘ ë‹¤ìŒê³¼ ê°™ì€ ë¡œê·¸ê°€ ì¶œë ¥ë©ë‹ˆë‹¤:

```
ğŸš€ Real-time Query Flow ë°ëª¨ ì‹œì‘
ğŸ“¡ WebSocket URL: ws://localhost:8080/ws
â±ï¸  ì‹¤í–‰ ì‹œê°„: 60ì´ˆ
ğŸ“Š ê¸°ë³¸ QPS: 2

ğŸ¬ ë°ì´í„° ìƒì„± ì‹œì‘...

ğŸ“Š ìƒì„±ëœ ì¿¼ë¦¬: 10 | ì‹œë‚˜ë¦¬ì˜¤: NORMAL | QPS: 2.00
ğŸ”„ ì‹œë‚˜ë¦¬ì˜¤ ì „í™˜: HIGH_LOAD  
ğŸ“Š ìƒì„±ëœ ì¿¼ë¦¬: 20 | ì‹œë‚˜ë¦¬ì˜¤: HIGH_LOAD | QPS: 6.00
ğŸ”„ ì‹œë‚˜ë¦¬ì˜¤ ì „í™˜: SLOW_QUERIES
ğŸ“Š ìƒì„±ëœ ì¿¼ë¦¬: 30 | ì‹œë‚˜ë¦¬ì˜¤: SLOW_QUERIES | QPS: 1.60
```

## ğŸ› ë¬¸ì œ í•´ê²°

### WebSocket ì—°ê²° ì‹¤íŒ¨
```bash
# control-plane ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
curl -I http://localhost:8080/health

# í¬íŠ¸ ì‚¬ìš© í™•ì¸
lsof -i :8080
```

### ë„êµ¬ ëˆ„ë½ ì˜¤ë¥˜
```bash
# bc ì„¤ì¹˜ í™•ì¸
which bc || echo "bcë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”"

# WebSocket í´ë¼ì´ì–¸íŠ¸ í™•ì¸
which websocat || which wscat || which curl
```

### ê¶Œí•œ ì˜¤ë¥˜
```bash
# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
chmod +x demo-query-flow.sh
```

## ğŸ“ ì»¤ìŠ¤í„°ë§ˆì´ì§•

ìŠ¤í¬ë¦½íŠ¸ ìƒë‹¨ì˜ ì„¤ì •ê°’ì„ ìˆ˜ì •í•˜ì—¬ ë™ì‘ì„ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
WS_URL="ws://localhost:8080/ws"    # WebSocket URL
DEMO_DURATION=60                   # ì‹¤í–‰ ì‹œê°„ (ì´ˆ)
BASE_QPS=2                         # ê¸°ë³¸ QPS
```

## ğŸ¬ ë°ëª¨ ì‹œì—° ìˆœì„œ

1. **ì¤€ë¹„**: ë°±ì—”ë“œ ì„œë²„ + í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰
2. **í™•ì¸**: ë¸Œë¼ìš°ì €ì—ì„œ ëŒ€ì‹œë³´ë“œ ì ‘ì†
3. **ì‹¤í–‰**: `./demo-query-flow.sh` ì‹¤í–‰
4. **ê´€ì°°**: Real-time Query Flow íŒ¨ë„ì˜ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ í™•ì¸
   - íŒŒí‹°í´ì´ App â†’ Pool â†’ DB â†’ App ê²½ë¡œë¡œ ì´ë™
   - ì¿¼ë¦¬ ì†ë„ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€í™”
   - ì‹œë‚˜ë¦¬ì˜¤ë³„ QPS ë° ì—ëŸ¬ìœ¨ ë³€í™”
   - ì‹¤ì‹œê°„ ì¿¼ë¦¬ ëª©ë¡ ì—…ë°ì´íŠ¸
5. **ì‹œë‚˜ë¦¬ì˜¤**: 15ì´ˆë§ˆë‹¤ ìë™ ì „í™˜ë˜ëŠ” ì„±ëŠ¥ ì‹œë‚˜ë¦¬ì˜¤ ê´€ì°°